Properly validate the array index and prevent a buffer overread